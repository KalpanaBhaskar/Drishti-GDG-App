<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Test - Drishti</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1e293b;
            color: #e2e8f0;
        }
        h1 {
            color: #60a5fa;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 10px;
        }
        .test-section {
            background: #334155;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #475569;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        .success {
            color: #10b981;
            font-weight: bold;
        }
        .error {
            color: #ef4444;
            font-weight: bold;
        }
        .log {
            background: #1e293b;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #3b82f6;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px solid #334155;
        }
    </style>
</head>
<body>
    <h1>üî• Firebase Integration Test</h1>
    
    <div class="test-section">
        <h2>üìù Test 1: Complaints Collection</h2>
        <p>This will test if complaints can be written to Firebase.</p>
        <button onclick="testComplaint()">Submit Test Complaint</button>
        <div id="complaintLog" class="log"></div>
    </div>

    <div class="test-section">
        <h2>üó∫Ô∏è Test 2: Zones Collection</h2>
        <p>This will test if zones can be written to Firebase.</p>
        <button onclick="testZones()">Save Test Zones</button>
        <div id="zonesLog" class="log"></div>
    </div>

    <div class="test-section">
        <h2>üìä Test 3: Read Data</h2>
        <p>Read existing data from Firebase.</p>
        <button onclick="readComplaints()">Read Complaints</button>
        <button onclick="readZones()">Read Zones</button>
        <div id="readLog" class="log"></div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getFirestore, 
            collection, 
            doc, 
            setDoc, 
            getDocs,
            serverTimestamp 
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyCpwHM0j6x9r6sNxOxYBNT1Ds5Vv6xHilk",
            authDomain: "drishti-bf2fc.firebaseapp.com",
            projectId: "drishti-bf2fc",
            storageBucket: "drishti-bf2fc.firebasestorage.app",
            messagingSenderId: "84044832861",
            appId: "1:84044832861:web:9a9dec7e5f64e8e54df8b5",
            measurementId: "G-FNQQYQGLGY"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        function log(elementId, message, type = 'info') {
            const logDiv = document.getElementById(elementId);
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            
            entry.innerHTML = `<span style="color: #64748b">[${timestamp}]</span> ${icon} ${message}`;
            logDiv.insertBefore(entry, logDiv.firstChild);
        }

        // Test Complaint
        window.testComplaint = async function() {
            log('complaintLog', 'Starting complaint test...', 'info');
            
            try {
                const testComplaint = {
                    id: `COMP-TEST-${Date.now()}`,
                    subject: 'Test Complaint from Firebase Test',
                    details: 'This is a test complaint to verify Firebase write access.',
                    importance: 'medium',
                    department: 'general',
                    status: 'open',
                    submittedBy: 'test@firebase.com',
                    submittedAt: new Date().toLocaleTimeString(),
                    createdAt: serverTimestamp()
                };

                log('complaintLog', `Creating complaint: ${testComplaint.id}`, 'info');
                
                const complaintRef = doc(db, 'complaints', testComplaint.id);
                await setDoc(complaintRef, testComplaint);
                
                log('complaintLog', `<span class="success">‚úÖ SUCCESS! Complaint saved to Firebase</span>`, 'success');
                log('complaintLog', `Complaint ID: ${testComplaint.id}`, 'success');
                log('complaintLog', 'Check Firebase Console: https://console.firebase.google.com/project/drishti-bf2fc/firestore', 'success');
                
            } catch (error) {
                log('complaintLog', `<span class="error">‚ùå ERROR: ${error.message}</span>`, 'error');
                log('complaintLog', `Error code: ${error.code}`, 'error');
                
                if (error.code === 'permission-denied') {
                    log('complaintLog', '‚ö†Ô∏è Firestore rules need to be updated!', 'error');
                }
            }
        };

        // Test Zones
        window.testZones = async function() {
            log('zonesLog', 'Starting zones test...', 'info');
            
            try {
                const testZones = [
                    { id: 'zone-a', name: 'Zone A', density: 45.123, predictedDensity: 50.456, status: 'normal' },
                    { id: 'zone-b', name: 'Zone B', density: 62.789, predictedDensity: 68.234, status: 'congested' },
                    { id: 'zone-c', name: 'Zone C', density: 78.345, predictedDensity: 85.678, status: 'bottleneck' },
                    { id: 'zone-d', name: 'Zone D', density: 38.901, predictedDensity: 42.345, status: 'normal' },
                    { id: 'zone-e', name: 'Zone E', density: 55.234, predictedDensity: 60.789, status: 'normal' },
                    { id: 'zone-f', name: 'Zone F', density: 50.567, predictedDensity: 55.123, status: 'normal' }
                ];

                log('zonesLog', 'Saving 6 test zones...', 'info');
                
                for (const zone of testZones) {
                    const zoneRef = doc(db, 'zones', zone.id);
                    await setDoc(zoneRef, {
                        ...zone,
                        updatedAt: serverTimestamp()
                    }, { merge: true });
                    
                    log('zonesLog', `‚úì Saved ${zone.id}: ${zone.name} (${zone.density.toFixed(3)}%)`, 'success');
                }
                
                log('zonesLog', `<span class="success">‚úÖ SUCCESS! All 6 zones saved to Firebase</span>`, 'success');
                log('zonesLog', 'Check Firebase Console: https://console.firebase.google.com/project/drishti-bf2fc/firestore', 'success');
                
            } catch (error) {
                log('zonesLog', `<span class="error">‚ùå ERROR: ${error.message}</span>`, 'error');
                log('zonesLog', `Error code: ${error.code}`, 'error');
                
                if (error.code === 'permission-denied') {
                    log('zonesLog', '‚ö†Ô∏è Firestore rules need to be updated!', 'error');
                }
            }
        };

        // Read Complaints
        window.readComplaints = async function() {
            log('readLog', 'Reading complaints from Firebase...', 'info');
            
            try {
                const querySnapshot = await getDocs(collection(db, 'complaints'));
                
                if (querySnapshot.empty) {
                    log('readLog', 'No complaints found in Firebase', 'info');
                } else {
                    log('readLog', `<span class="success">Found ${querySnapshot.size} complaint(s)</span>`, 'success');
                    
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        log('readLog', `üìù ${doc.id}: "${data.subject}" - ${data.status}`, 'success');
                    });
                }
            } catch (error) {
                log('readLog', `<span class="error">‚ùå ERROR: ${error.message}</span>`, 'error');
            }
        };

        // Read Zones
        window.readZones = async function() {
            log('readLog', 'Reading zones from Firebase...', 'info');
            
            try {
                const querySnapshot = await getDocs(collection(db, 'zones'));
                
                if (querySnapshot.empty) {
                    log('readLog', 'No zones found in Firebase', 'info');
                } else {
                    log('readLog', `<span class="success">Found ${querySnapshot.size} zone(s)</span>`, 'success');
                    
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        log('readLog', `üó∫Ô∏è ${doc.id}: ${data.name} - ${data.density?.toFixed(3)}% (${data.status})`, 'success');
                    });
                }
            } catch (error) {
                log('readLog', `<span class="error">‚ùå ERROR: ${error.message}</span>`, 'error');
            }
        };

        // Auto-read on page load
        window.addEventListener('load', () => {
            log('readLog', 'üîç Auto-reading existing data...', 'info');
            readComplaints();
            setTimeout(() => readZones(), 1000);
        });
    </script>
</body>
</html>
